# TCP/IP

TCP, IP ëŠ” ëª¨ë‘ í”„ë¡œí† ì½œì˜ ì¼ì¢…ì´ë‹¤. 

> ğŸ’¡**í”„ë¡œí† ì½œì€ ë¬´ì—‡ì¸ê°€?** 
> 
>  í”„ë¡œí† ì½œì€ ì»´í“¨í„° ë‚´ë¶€ì—ì„œ, ë˜ëŠ” ì»´í“¨í„° ì‚¬ì´ì—ì„œ ë°ì´í„°ì˜ êµí™˜ ë°©ì‹ì„ ì •ì˜í•˜ëŠ” ê·œì¹™ ì²´ê³„ì…ë‹ˆë‹¤. ê¸°ê¸° ê°„ í†µì‹ ì€ êµí™˜ë˜ëŠ” ë°ì´í„°ì˜ í˜•ì‹ì— ëŒ€í•´ ìƒí˜¸ í•©ì˜ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤. ì´ëŸ° í˜•ì‹ì„ ì •ì˜í•˜ëŠ” ê·œì¹™ì˜ ì§‘í•©ì„ í”„ë¡œí† ì½œì´ë¼ê³  í•©ë‹ˆë‹¤.
> 
> ì¶œì²˜ : MDN

## TCP(Transmission Control Protocol)

OSI 7 ê³„ì¸µ ì¤‘ ì „ì†¡ ê³„ì¸µì—ì„œ í™œìš©ë˜ëŠ” í”„ë¡œí† ì½œ ì¤‘ í•˜ë‚˜ì´ë‹¤. 3ê³„ì¸µì˜ IP í”„ë¡œí† ì½œê³¼ í•¨ê»˜ ì“°ì´ëŠ” ê²½ìš°ê°€ ë§ì•„ TCP/IP ë¡œ í‘œí˜„í•˜ê¸°ë„ í•œë‹¤. 

### TCP íŠ¹ì§•

- ì‹ ë¢°ì„±: íŒ¨í‚· ì†ì‹¤Â·ì˜¤ë¥˜ë¥¼ ê°ì§€í•˜ê³  ì¬ì „ì†¡ì„ í†µí•´ ë³µêµ¬í•©ë‹ˆë‹¤.
- ìˆœì„œ ë³´ì¥: ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ ë‹¨ìœ„ë¡œ ìˆœì„œë¥¼ ìœ ì§€í•˜ì—¬ ì „ì†¡í•©ë‹ˆë‹¤.
- ì—°ê²° ì§€í–¥ì : 3-way handshakeë¡œ ì—°ê²°ì„ ì„¤ì •í•˜ê³ , FIN êµí™˜ìœ¼ë¡œ ì¢…ë£Œí•©ë‹ˆë‹¤.
- ì–‘ë°©í–¥ í†µì‹ : í•œ ì—°ê²°ì—ì„œ ì–‘ë°©í–¥ ë°ì´í„° íë¦„ì„ ì§€ì›í•©ë‹ˆë‹¤.
- í¬íŠ¸ ê¸°ë°˜ ë‹¤ì¤‘í™”: IP ì£¼ì†Œ + í¬íŠ¸ ë²ˆí˜¸ ì¡°í•©ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹ë³„í•©ë‹ˆë‹¤.

### TCP ì„¸ê·¸ë¨¼íŠ¸ 

![tcp_segment](../images/tcp_segment.png)

- ì‹œí€€ìŠ¤ ë²ˆí˜¸(Sequence Number): ë°ì´í„°ì˜ ìˆœì„œë¥¼ ì¶”ì 
- ACK ë²ˆí˜¸(Ack Number): ë‹¤ìŒìœ¼ë¡œ ê¸°ëŒ€í•˜ëŠ” ë°”ì´íŠ¸ ë²ˆí˜¸
- í”Œë˜ê·¸(Flags): SYN, ACK, FIN, RST, PSH, URG, ECE, CWR
- ìœˆë„ìš°(Window): ìˆ˜ì‹  ì¸¡ì´ í—ˆìš© ê°€ëŠ¥í•œ ë°ì´í„° í¬ê¸°
- ì²´í¬ì„¬(Checksum): í—¤ë”Â·ë°ì´í„° ì˜¤ë¥˜ ê²€ì¶œìš© (í•­ìƒ í•„ìˆ˜)

### 3-way Handshake

3-way HandshakeëŠ” ì†¡ì‹ ì¸¡ê³¼ ìˆ˜ì‹ ì¸¡ ëª¨ë‘ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ ì¤€ë¹„ê°€ ë˜ì–´ìˆìŒì„ í™•ì¸í•˜ê³ , íŒ¨í‚· ìˆœì„œì™€ ì‹ ë¢°ì„±ì„ ë³´ì¥í•  ìˆ˜ ìˆëŠ” ì´ˆê¸° ìƒíƒœë¥¼ ë§ì¶”ëŠ” ê³¼ì •ì´ë‹¤. 

![tcp_handshake](../images/tcp-handshake.png)

### 4-way Handshake

4-way HandshakeëŠ” TCP ì—°ê²°ì„ ì¢…ë£Œí•˜ëŠ” ê³¼ì •ì´ë‹¤. ì–‘ì¸¡ì´ FIN í”Œë˜ê·¸ë¥¼ êµí™˜í•˜ì—¬ ì—°ê²° ì¢…ë£Œë¥¼ í™•ì¸í•œë‹¤.

![tcp_4way_handshake](../images/tcp_4way_handshake.png)

> ğŸ’¡**TCPëŠ” ì™œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ”ê°€?**
> 
> - Checksum ì„ í†µí•´ì„œ ì†ìƒì„ ë°©ì§€
> - íë¦„ ì œì–´(ìˆ˜ì‹  ìœˆë„ìš°, ZWP, ìœˆë„ìš° ìŠ¤ì¼€ì¼ë§)ë¡œ ìˆ˜ì‹  ë²„í¼ë¥¼ ë³´í˜¸
> - í˜¼ì¡ ì œì–´(RTO ì¶”ì •, Selective ACK)ë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ í˜¼ì¡ì—ë„ ëŒ€ì‘
> - ì´ˆê¸° ì‹œí€¸ìŠ¤ ë²ˆí˜¸ë¥´ ì–‘ì¸¡ì´ êµí™˜í•´ ì˜ˆì „ ì—°ê²°ì˜ ì„¸ê·¸ë¨¼íŠ¸ê°€ í˜„ì¬ ì—°ê²°ì„ ì˜¤ì—¼ì‹œí‚¤ì§€ ì•Šë„ë¡ í•¨
> - ì—°ê²° ì¢…ë£Œ í›„ì—ë„ ì ì‹œ ëŒ€ê¸°í•˜ì—¬ ì§€ì—° ë„ì°© ì„¸ê·¸ë¨¼íŠ¸ê°€ ë‹¤ë¥¸ ì—°ê²°ì— ì„ì´ì§€ ì•Šê²Œ ê²©ë¦¬

**TCP í˜¼ì¡ ì œì–´ ì•Œê³ ë¦¬ì¦˜ > AIMD(Additive Increase Multiplicative Decrease)**
![tcp_congestion_control_algorithm](../images/TCP_AIMD.png)

### TCP vs UDP

> ğŸ’¡**ìµœê·¼ UDP ê°€ ì£¼ëª©ë°›ëŠ” ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€?**
> 
> í†µì‹  ê¸°ìˆ ì˜ ë°œë‹¬(5G, Wi-Fi) -> í° ë°ì´í„° ì „ì†¡ ê°€ëŠ¥ -> UDP í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ì „ì†¡
> ëŒ€í‘œì ìœ¼ë¡œ Youtube, Netflix ì™€ ê°™ì€ ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ê°€ UDP ê¸°ë°˜ìœ¼ë¡œ ë™ì‘
> 
> HTTP 2.0 ì—ì„œëŠ” TCP ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— HOLB(Head of Line Blocking) ë¬¸ì œê°€ ë°œìƒ
> êµ¬ê¸€ì´ ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ UDP ê¸°ë°˜ì˜ QUIC í”„ë¡œí† ì½œì„ ê°œë°œ
> HTTP 2.0 ì—ì„œ ì¡´ì¬í•˜ë˜ ë¬¸ì œì ì„ ëŒ€ë¶€ë¶„ í•´ê²°, RTT(Round Trip Time) ì œë¡œ ìˆ˜ì¤€ìœ¼ë¡œ ì¤„ì´ê³ , íŒ¨í‚· ì†ì‹¤ì— ëŒ€í•œ ë¹ ë¥¸ ëŒ€ì‘, ì‚¬ìš©ì IP ê°€ ë°”ë€Œì–´ë„ ì—°ê²°ì´ ìœ ì§€

![udp_header](../images/udp_header.png)

| í•­ëª©        | TCP                      | UDP                |
| --------- | ------------------------ | ------------------ |
| **ì—°ê²° ì—¬ë¶€** | ì—°ê²°í˜• (3-way handshake í•„ìš”) | ë¹„ì—°ê²°í˜• (ë°”ë¡œ ì „ì†¡)       |
| **ì‹ ë¢°ì„±**   | íŒ¨í‚· ìˆœì„œÂ·ì¬ì „ì†¡ ë³´ì¥             | ë³´ì¥í•˜ì§€ ì•ŠìŒ            |
| **ì†ë„**    | ëŠë¦¼ (ê²€ì¦ ì ˆì°¨ ë§ìŒ)            | ë¹ ë¦„ (ê²€ì¦ ì ˆì°¨ ì—†ìŒ)      |
| **ìš©ë„**    | íŒŒì¼ ì „ì†¡, ì´ë©”ì¼, ì›¹ ë“±          | ìŠ¤íŠ¸ë¦¬ë°, ê²Œì„, ì‹¤ì‹œê°„ í†µì‹  ë“± |
| **í—¤ë” í¬ê¸°** | 20ë°”ì´íŠ¸ ì´ìƒ                 | 8ë°”ì´íŠ¸               |


> ğŸ’¡**UDP ëŠ” ì‹ ë¢°ì„±ì„ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë° ì–´ë–»ê²Œ ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ì— ì‚¬ìš©ë˜ë‚˜?**
> 
> ë§Œì•½ TCP ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ íŒ¨í‚·ì´ ì†ì‹¤ë˜ëŠ” ìˆœê°„ ì¬ì „ì†¡ì´ ë°œìƒí•˜ë©° ì„œë¹„ìŠ¤ ê²½í—˜ì— í° ì˜í–¥ì„ ë¯¸ì¹¨.
> ë°˜ë©´ UDP ëŠ” íŒ¨í‚·ì˜ ì†ì‹¤ì„ ë³´ì¥í•˜ì§€ ì•Šì§€ë§Œ ë¹ ë¥¸ ë°ì´í„°ì˜ ì „ì†¡ì„ ëª©ì ìœ¼ë¡œ í•¨.
> í•˜ì§€ë§Œ UDP ìì²´ë§Œìœ¼ë¡œëŠ” ë°ì´í„°ì˜ ìˆœì„œë¥¼ ë³´ì¥í•˜ì§€ ì•ŠëŠ” ë“± ë³´ì™„í•´ì•¼í•  ë¶€ë¶„ë“¤ì´ ìˆìŒ
> -> RTP, DTLS, QUIC ì™€ ê°™ì€ í”„ë¡œí† ì½œë“¤ì„ í†µí•´ ë³´ì™„í•˜ì—¬ ì‚¬ìš©

## IP(Internet Protocol)

IPëŠ” ì¸í„°ë„·ì˜ ê¸°ë³¸ ì–¸ì–´ë¡œ, ëª¨ë“  ì¥ì¹˜ê°€ â€œIP ì£¼ì†Œâ€ë¥¼ í†µí•´ ì„œë¡œë¥¼ ì°¾ê³ , â€œíŒ¨í‚·â€ ë‹¨ìœ„ë¡œ ë°ì´í„°ë¥¼ êµí™˜í•˜ë„ë¡ í•˜ëŠ” ì¸í„°ë„· í†µì‹ ì˜ í•µì‹¬ í”„ë¡œí† ì½œì´ë‹¤.

![internet_protocol_ip_address_diagram](../images/internet_protocol_ip_address_diagram.svg)

| íŠ¹ì§•           | ì„¤ëª…                                   |
| ------------ | ------------------------------------ |
| **ë¹„ì—°ê²°í˜•**     | ì „ì†¡ ì „ ì—°ê²°ì„ ë§ºì§€ ì•ŠìŒ (UDPì™€ ìœ ì‚¬)             |
| **ë¹„ì‹ ë¢°ì„±**     | íŒ¨í‚· ì†ì‹¤ ì‹œ ì¬ì „ì†¡ì„ ì§ì ‘ ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ (TCPê°€ ë³´ì™„)    |
| **íŒ¨í‚· ê¸°ë°˜ ì „ì†¡** | ë°ì´í„°ëŠ” ì—¬ëŸ¬ ê°œì˜ íŒ¨í‚·ìœ¼ë¡œ ë¶„í• ë˜ì–´ ì „ì†¡              |
| **ë¼ìš°íŒ… ê¸°ëŠ¥**   | ëª©ì ì§€ê¹Œì§€ì˜ ìµœì  ê²½ë¡œë¥¼ ì„ íƒ                     |
| **ICMP ì—°ë™**  | ì˜¤ë¥˜ ë³´ê³ (ì˜ˆ: ëª©ì ì§€ ë„ë‹¬ ë¶ˆê°€) ë° ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸ì— ì‚¬ìš© |


![ip_packet](../images/ip_packet.png)

| í•„ë“œ                               | ì„¤ëª…                         |
| -------------------------------- | -------------------------- |
| **Version**                      | IPv4 (ê°’ = 4)               |
| **IHL (Header Length)**          | í—¤ë” ê¸¸ì´ (32ë¹„íŠ¸ ë‹¨ìœ„)            |
| **Type of Service (TOS)**        | ìš°ì„ ìˆœìœ„, ì§€ì—°, ì‹ ë¢°ì„±, ì²˜ë¦¬ì†ë„ ë“±      |
| **Total Length**                 | ì „ì²´ íŒ¨í‚· ê¸¸ì´ (ìµœëŒ€ 65,535ë°”ì´íŠ¸)    |
| **Identification**               | ë‹¨í¸í™”ëœ íŒ¨í‚·ì„ ì¬ì¡°ë¦½í•˜ê¸° ìœ„í•œ ID       |
| **Flags (DF, MF)**               | DF=ë‹¨í¸í™” ê¸ˆì§€, MF=ë” ìˆìŒ í‘œì‹œ      |
| **Fragment Offset**              | ì›ë³¸ ë°ì´í„°ì—ì„œì˜ ì˜¤í”„ì…‹ ìœ„ì¹˜           |
| **Time to Live (TTL)**           | ìƒì¡´ ì‹œê°„ (ê° í™‰ì—ì„œ 1ì”© ê°ì†Œ)        |
| **Protocol**                     | ìƒìœ„ ê³„ì¸µ ì‹ë³„ (TCP=6, UDP=17 ë“±) |
| **Header Checksum**              | í—¤ë” ì˜¤ë¥˜ ê²€ì¶œìš©                  |
| **Source / Destination Address** | ì†¡ì‹ ì, ìˆ˜ì‹ ì IP ì£¼ì†Œ             |
| **Options**                      | ì‹œê°„ ê¸°ë¡, ë¼ìš°íŒ… ì œì–´, ë³´ì•ˆ ì •ë³´ ë“±     |
| **Padding**                      | 32ë¹„íŠ¸ ì •ë ¬ì„ ìœ„í•œ 0 íŒ¨ë”©           |


> ğŸ’¡IP ìš°íšŒ? IP ê¸°ë°˜ ì°¨ë‹¨? IP ê°€ ë­ê¸¸ë˜ í•´ë‹¹ ê¸°ëŠ¥ë“¤ì´ ê°€ëŠ¥í•œê±¸ê¹Œ?
> 
> ëª¨ë“  ì¸í„°ë„· ì—°ê²° ì¥ì¹˜ëŠ” IP ì£¼ì†Œë¥¼ ê°€ì§„ë‹¤. ê³µì¸ IP ëŠ” ì™¸ë¶€ì— ê³µê°œëœ ì£¼ì†Œì´ë©° ì‚¬ì„¤ IP ëŠ” ê°™ì€ ë„¤íŠ¸ì›Œí¬ ì•ˆì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ì£¼ì†Œë¥¼ ë§í•œë‹¤. 
> ì¦‰, ê°™ì€ ì™€ì´íŒŒì´ë¥¼ ì“°ë©´ ê°™ì€ ê³µì¸ IP ì£¼ì†Œë¡œ ë³´ì´ê²Œ ëœë‹¤. 
> IP ì£¼ì†Œì—ëŠ” ISP(í†µì‹ ì‚¬) ë³„ë¡œ í• ë‹¹ëœ ì§€ì—­ ì½”ë“œê°€ í¬í•¨ë˜ì–´ ìˆì–´, ê°€ë” í•´ì™¸ì—ì„œ ì„œë¹„ìŠ¤ê°€ ë˜ì§€ ì•ŠëŠ” ê²½ìš°ëŠ” ì´ë¥¼ í™œìš©í•œ ê²ƒì´ë‹¤. 
> í”„ë¡ì‹œ, NAT(Network Address Translation), VPN(ê°€ìƒ ì‚¬ì„¤ë§) ë“±ì„ í™œìš©í•˜ë©´ IP ìš°íšŒê°€ ê°€ëŠ¥í•˜ë‹¤.

### References

- https://datatracker.ietf.org/doc/html/rfc9293
- https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-TCP-IP-%EC%A0%95%EB%A6%AC-%F0%9F%91%AB%F0%9F%8F%BD-TCP-IP-4%EA%B3%84%EC%B8%B5
- https://docs.tosspayments.com/resources/glossary/tcp#tcp-%ED%86%B5%EC%8B%A0-%EA%B3%BC%EC%A0%95
- https://code-lab1.tistory.com/30
- https://inpa.tistory.com/entry/NW-%F0%9F%8C%90-%EC%95%84%EC%A7%81%EB%8F%84-%EB%AA%A8%ED%98%B8%ED%95%9C-TCP-UDP-%EA%B0%9C%EB%85%90-%E2%9D%93-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EC%9E%90
- https://datatracker.ietf.org/doc/html/rfc768
- https://datatracker.ietf.org/doc/html/rfc791
- https://www.geeksforgeeks.org/computer-networks/what-is-internet-protocol-ip/
- https://www.cloudflare.com/ko-kr/learning/network-layer/internet-protocol/